---
alwaysApply: true
---

# Tech Stack

## Core Framework

- **Next.js 16**: App Router architecture, Server Components by default
- **React 19**: Latest React with React Compiler enabled
- **TypeScript 5**: Strict type checking throughout

## Database & ORM

- **PostgreSQL**: Primary database
- **Prisma 6**: ORM with type-safe database access
- **Database Schema**: User, Chat, ChatMessage, App, Class, Method models

## UI & Styling

- **shadcn/ui**: Component library built on Radix UI
- **Tailwind CSS 4**: Utility-first styling
- **Components**: Button, Input, Card, ScrollArea, Avatar, Dialog, Table

## AI & API

- **OpenAI SDK**: Chat completions, embeddings, tool execution
  - gpt-4-turbo-preview: Main chat model, tool orchestration
  - gpt-3.5-turbo: Tool wrapper processing, META_TOOLS Q&A
  - text-embedding-3-small: Vector embeddings (1536 dimensions)
- **Zod**: Runtime type validation for server actions
- **pgvector**: PostgreSQL extension for vector similarity search
  - HNSW indexes for efficient cosine similarity
  - Stores embeddings for apps, classes, methods

## Development Tools

- **ESLint**: Code linting with Next.js config
- **Prettier**: Code formatting
- **TypeScript**: Static type checking

## Architecture Patterns

### Server Actions
- All data mutations use Server Actions (`"use server"`)
- Type-safe with Zod validation
- Located in `app/actions/`

### Client Components
- Only used for interactive UI (forms, localStorage access)
- Marked with `"use client"` directive
- Minimal client-side logic

### Data Flow
- Server Components fetch data directly
- Client Components call Server Actions for mutations
- Prisma Client singleton pattern in `lib/prisma.ts`

### User Identification
- Device-based: `deviceKey` stored in localStorage
- No authentication system
- User created/retrieved via device key

### Tool Selection System (ReAct Loop)
- Iterative LLM-driven code generation and execution
- META_TOOLS for database queries (RAG vector search)
- Located in `lib/tool-selector.ts`
- Max 10 iterations per query

### Tool Wrapper System
- Two-tier LLM architecture (gpt-4 + gpt-3.5)
- Main model never sees raw tool results
- gpt-3.5-turbo processes all tool outputs
- Single natural language `query` parameter per tool
- Located in `lib/tool-wrapper.ts`

### RAG Vector Search
- Embeddings stored in separate *_data tables
- pgvector with HNSW indexes for fast similarity search
- Cosine distance operator (<=>)
- Threshold: 0.5 for relevant results
- Located in `lib/meta-tools/vector-search.ts`

## Deployment

- **Vercel**: Target deployment platform
- **Environment Variables**: DATABASE_URL, OPENAI_API_KEY

## Key Dependencies

```json
{
  "next": "16.0.3",
  "react": "19.2.0",
  "@prisma/client": "^6.19.0",
  "openai": "^6.9.0",
  "zod": "^4.1.12"
}
```

## File Structure Conventions

- `app/`: Next.js App Router pages and routes
- `app/actions/`: Server Actions (chat, tools, user, vectors)
- `components/`: React components (UI and feature components)
- `lib/`: Utility functions and services
  - `lib/meta-tools/`: META_TOOLS implementations (RAG + LLM)
  - `lib/tool-selector.ts`: ReAct loop for tool selection
  - `lib/tool-wrapper.ts`: LLM wrapper for tool execution
  - `lib/chat-service.ts`: Main chat orchestration
  - `lib/embedding-service.ts`: OpenAI embeddings
  - `lib/vector-service.ts`: Vector data population
- `types/`: TypeScript type definitions
- `prisma/`: Database schema and migrations
- `prisma/seed.ts`: Database seeding script with LLM-powered tool generation
- `scripts/`: Utility scripts and test tools
  - `populate-vectors.ts`: Generate embeddings for all tools
  - `test-chat.ts`: End-to-end chat flow testing
  - `test-similarity.ts`: Vector similarity analysis
  - `test-vector-flow.ts`: Step-by-step vector search validation
  - `check-db.ts`: Database content inspection
  - All test scripts use dotenv for environment variable loading
- `.cursor/rules/`: Cursor AI documentation (*.mdc files)
